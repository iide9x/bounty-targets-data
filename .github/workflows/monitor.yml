- name: Check for new domains
  env:
    TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    TG_CHAT: ${{ secrets.TELEGRAM_CHAT_ID }}
  run: |
    curl -sf https://raw.githubusercontent.com/arkadiyt/bounty-targets-data/main/domains.txt > new.txt
    curl -sf https://raw.githubusercontent.com/arkadiyt/bounty-targets-data/main/wildcards.txt >> new.txt
    
    if [ -f old.txt ]; then
      comm -13 <(sort -u old.txt) <(sort -u new.txt) > diff.txt
      
      if [ -s diff.txt ]; then
        COUNT=$(wc -l < diff.txt)
        MSG="ðŸŽ¯ $COUNT new domains found!"
        curl -sf "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
          -d "chat_id=${TG_CHAT}" \
          -d "text=${MSG}" >/dev/null
        
        # Send domains in batches
        cat diff.txt | while read domain; do
          curl -sf "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
            -d "chat_id=${TG_CHAT}" \
            -d "text=ðŸ†• $domain" >/dev/null
          sleep 0.1
        done
      fi
    fi
    
    mv new.txt old.txt
